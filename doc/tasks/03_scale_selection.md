# スケール選択機能実装タスク

## 概要
コード選択のリスト表示でスケール（音階）を変更できる機能を実装します。現在はC Majorスケールのみですが、異なるキーのメジャー・マイナースケールや、その他のスケールを選択可能にします。

## 実装タスク

### 1. データモデルの拡張
- [x] **スケール型定義の追加**
  - [x] `types.ts`にスケール型を定義
  - [x] スケールタイプの列挙型を追加（メジャー、ナチュラルマイナー、ハーモニックマイナーなど）
  - [x] スケール構造を表すインターフェース定義

- [x] **スケール生成関数の実装**
  - [x] 任意のルート音とスケールタイプからコード一覧を生成する関数
  - [x] メジャースケールのダイアトニックコード生成関数
  - [x] ナチュラルマイナースケールのダイアトニックコード生成関数
  - [x] その他スケール（ペンタトニック、ブルースなど）の生成関数（今後の拡張）

- [x] **プリセットスケールの定義**
  - [x] 一般的な12キーのメジャースケール定義
  - [x] 一般的な12キーのナチュラルマイナースケール定義
  - [x] スケール表示名の日本語対応

### 2. UIコンポーネントの拡張

- [x] **スケール選択UI の実装**
  - [x] `ChordSelector.tsx`にスケール選択ドロップダウンを追加
  - [x] キー選択（C, D, E, F, G, A, B, C#, F#, G#, A#, D#）
  - [x] スケールタイプ選択（メジャー、マイナー）
  - [x] 選択したスケールの表示名（例：「Gメジャー」「Amナチュラルマイナー」）

- [x] **コードリスト表示の動的更新**
  - [x] 選択されたスケールに基づくコード一覧の動的生成
  - [x] ローマ数字表記のサポート（I, ii, iii, IV, V, vi, viiø）
  - [x] コード機能表示（トニック、サブドミナント、ドミナントの色分け）

### 3. 五度圏表示の対応

- [x] **五度圏表示の拡張**
  - [x] 選択されたスケールに応じた五度圏のハイライト
  - [x] スケール外のコードの視覚的区別（グレーアウトなど）
  - [ ] 選択されたキーを中心とした五度圏の回転表示（今後の拡張）

### 4. 状態管理の実装

- [ ] **スケール状態の管理**
  - [ ] 現在選択中のスケール情報をstateで管理
  - [ ] スケール変更時のコード選択状態のリセット
  - [ ] URL パラメータによるスケール情報の永続化（今後の拡張）

### 5. コード生成ロジックの実装

- [ ] **動的コード生成の実装**
  - [ ] `lib/scales.ts` 新規作成
  - [ ] 各スケールの音程パターン定義
  - [ ] ルート音とスケールタイプからダイアトニックコードを動的生成
  - [ ] コード品質の度数表記サポート

### 6. 既存機能との統合

- [ ] **コード進行機能との連携**
  - [ ] 選択されたスケール内のコード進行のみ許可
  - [ ] プリセット進行の動的キー変換
  - [ ] コード進行の調判定機能

- [ ] **音声再生機能の対応**
  - [ ] 異なるキーでのコード再生確認
  - [ ] オクターブ調整の最適化

### 7. ユーザビリティの向上

- [ ] **ヘルプ機能の追加**
  - [ ] スケールとは何かの説明
  - [ ] 各スケールの特徴と使用例
  - [ ] 初心者向けのスケール選択ガイド

- [ ] **表示の最適化**
  - [ ] スケール名の日本語表示
  - [ ] コード機能の色分け凡例
  - [ ] レスポンシブ対応

### 8. テストとQA

- [ ] **機能テスト**
  - [ ] 各スケールでの正しいコード生成確認
  - [ ] UI操作の動作確認
  - [ ] 五度圏表示との連携確認

- [ ] **音楽理論的妥当性の確認**
  - [ ] 生成されるダイアトニックコードの音楽理論的正確性
  - [ ] 異なるキーでの正しい音程関係
  - [ ] コード機能表示の正確性

## 技術要件

- React + TypeScript
- 既存の音声エンジン（Tone.js）との互換性
- 既存のコード定義との統合
- パフォーマンスを考慮した動的生成

## 成果物

1. `lib/scales.ts` - スケール定義と生成ロジック
2. `lib/types.ts` の拡張 - スケール関連型定義
3. `components/ChordSelector.tsx` の機能拡張 - スケール選択UI
4. `components/CircleOfFifths.tsx` の機能拡張 - スケール対応
5. 既存コードファイルの統合調整

## 優先度

1. **高**: メジャー・マイナースケールの基本実装
2. **中**: UI/UX改善とヘルプ機能
3. **低**: 拡張スケール（ペンタトニック、ブルースなど）の対応

## 注意事項

- 既存のC Majorスケールとの後方互換性を保つ
- パフォーマンスに配慮した実装（不要な再描画を避ける）
- 音楽理論に基づいた正確な実装
- 初心者にも分かりやすいUI設計
